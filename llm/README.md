# ЁЯПн Automotive Chat LLM

р╕гр╕░р╕Ър╕Ър╕Цр╕▓р╕б-р╕Хр╕нр╕Ър╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е Automotive р╕Фр╣Йр╕зр╕в LLM (Large Language Model) р╕Чр╕╡р╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Хр╕нр╕Ър╕Др╕│р╕Цр╕▓р╕бр╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е MySQL

## ЁЯМЯ р╕Др╕╕р╕Ур╕кр╕бр╕Ър╕▒р╕Хр╕┤

- тЬЕ р╕Цр╕▓р╕б-р╕Хр╕нр╕Ър╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Ир╕▓р╕Бр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е MySQL
- тЬЕ р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Хр╕▓р╕гр╕▓р╕З sewing_* р╣Бр╕ер╕░ qc_* (р╕Зр╕▓р╕Щр╣Ар╕вр╣Зр╕Ър╣Бр╕ер╕░р╕Др╕зр╕Ър╕Др╕╕р╕бр╕Др╕╕р╕Ур╕ар╕▓р╕Ю)
- тЬЕ р╣Гр╕Кр╣Й Ollama LLM (llama3.1) р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е
- тЬЕ р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ър╕нр╕┤р╕Щр╣Ар╕Чр╕нр╕гр╣Мр╣Ар╕Яр╕Лр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕Фр╕кр╕нр╕Ъ
- тЬЕ REST API р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕нр╕╖р╣Ир╕Щ (Grafana, HTML)
- тЬЕ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Др╣Йр╕Фр╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣И (Modular Architecture)

## ЁЯУБ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Ыр╕гр╣Ар╕Ир╕Д

```
chat_llm/
тФЬтФАтФА __init__.py           # Package initialization
тФЬтФАтФА config.py             # р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕гр╕░р╕Ър╕Ъ
тФЬтФАтФА database.py           # р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
тФЬтФАтФА llm_agent.py          # LLM Agent р╣Бр╕ер╕░ Langchain
тФЬтФАтФА app.py                # FastAPI application р╕лр╕ер╕▒р╕Б
тФЬтФАтФА templates/
тФВ   тФФтФАтФА index.html        # р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ър╕нр╕┤р╕Щр╣Ар╕Чр╕нр╕гр╣Мр╣Ар╕Яр╕Л
тФЬтФАтФА requirements.txt      # Python packages
тФФтФАтФА README.md            # р╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Щр╕╡р╣Й
```

## ЁЯЪА р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Бр╕ер╕░р╕гр╕▒р╕Щ

### 1. р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Dependencies

```bash
pip install -r requirements.txt
```

### 2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Environment Variables

р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М `.env` р╣Гр╕Щр╣Др╕Фр╣Ар╕гр╕Бр╕Чр╕нр╕гр╕╡р╕лр╕ер╕▒р╕Б:

```env
# р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е MySQL
MYSQL_HOST=192.168.0.44
MYSQL_PORT=3306
MYSQL_USER=user
MYSQL_PASS=user
MYSQL_DB=automotive

# р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Ollama LLM
OLLAMA_MODEL=llama3.1
OLLAMA_TEMPERATURE=0.1
```

### 3. р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ Ollama

```bash
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Ollama р╕гр╕▒р╕Щр╕нр╕вр╕╣р╣И
ollama list

# р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╣Вр╕бр╣Ар╕Фр╕е р╣Гр╕лр╣Йр╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Ф
ollama pull llama3.1
```

### 4. р╕гр╕▒р╕Щр╣Бр╕нр╕Ыр╕Юр╕ер╕┤р╣Ар╕Др╕Кр╕▒р╕Щ

```bash
```bash
cd /home/weerachai
uvicorn chat_llm.app:app --host 0.0.0.0 --port 8000
```

# р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╕гр╕▒р╕Щр╕Фр╣Йр╕зр╕в Python
cd chat_llm
python -m uvicorn app:app --host 0.0.0.0 --port 8000
```

### 5. р╣Ар╕Вр╣Йр╕▓р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

- **р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ:** http://localhost:8000
- **API Documentation:** http://localhost:8000/docs
- **Health Check:** http://localhost:8000/health

## ЁЯФЧ API Endpoints

### GET /health
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕╕р╕Вр╕ар╕▓р╕Юр╕гр╕░р╕Ър╕Ъ

```json
{
  "status": "ok",
  "mysql": {
    "host": "192.168.0.44",
    "db": "automotive",
    "allowed_tables": ["sewing_target", "qc_issue", ...]
  },
  "model": "llama3.1"
}
```

### GET /tables
р╕Фр╕╣р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕Хр╕▓р╕гр╕▓р╕Зр╕Чр╕╡р╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕нр╕Ър╕Цр╕▓р╕б

```json
{
  "allowed_tables": [
    "sewing_3rd", "sewing_fb", "sewing_fc", ...,
    "qc_3rd", "qc_fb", "qc_fc", ...
  ]
}
```

### GET /tables/descriptions
р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Бр╕ер╕░р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░р╕Хр╕▓р╕гр╕▓р╕З

```json
{
  "table_descriptions": {
    "sewing_man_act": "р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З (actual manpower)",
    "qc_ng": "р╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Зр╕▓р╕Щ NG (р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Др╕бр╣Ир╕Ьр╣Ир╕▓р╕Щр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ)",
    ...
  },
  "total_tables": 19
}
```

### POST /chat
р╕кр╣Ир╕Зр╕Др╕│р╕Цр╕▓р╕бр╣Бр╕ер╕░р╕гр╕▒р╕Ър╕Др╕│р╕Хр╕нр╕Ъ

**Request:**
```json
{
  "question": "р╕кр╕гр╕╕р╕Ыр╕Ир╕│р╕Щр╕зр╕Щр╕Зр╕▓р╕Щр╣Ар╕вр╣Зр╕Ър╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕гр╕╕р╣Ир╕Щр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Гр╕Щр╣Ар╕Фр╕╖р╕нр╕Щр╕Бр╕▒р╕Щр╕вр╕▓р╕вр╕Щ 2025"
}
```

**Response:**
```json
{
  "answer": "р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е automotive..."
}
```

### GET /status
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕гр╕░р╕Ър╕Ър╕нр╕вр╣Ир╕▓р╕Зр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф

## ЁЯОп р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Бр╕▒р╕Ъ Grafana р╣Бр╕ер╕░ HTML

### р╕кр╕│р╕лр╕гр╕▒р╕Ъ Grafana
р╣Гр╕Кр╣Й Infinity Data Source plugin р╣Ар╕гр╕╡р╕вр╕Б API:

```bash
# URL
http://your-server:8000/chat

# Method: POST
# Body:
{
  "question": "р╕кр╕гр╕╕р╕Ыр╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╕Бр╕▓р╕гр╕Ьр╕ер╕┤р╕Хр╕гр╕▓р╕вр╕зр╕▒р╕Щ"
}
```

### р╕кр╕│р╕лр╕гр╕▒р╕Ъ HTML/JavaScript
```javascript
async function askQuestion(question) {
  const response = await fetch('/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ question: question })
  });
  
  const data = await response.json();
  return data.answer;
}
```

## ЁЯУК р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Др╕│р╕Цр╕▓р╕б

### р╕Др╕│р╕Цр╕▓р╕бр╕Чр╕▒р╣Ир╕зр╣Др╕Ы
- "р╕бр╕╡р╕Хр╕▓р╕гр╕▓р╕Зр╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕Зр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ?"
- "р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Хр╕▓р╕гр╕▓р╕З sewing_target 5 р╣Бр╕Цр╕зр╣Бр╕гр╕Б"

### р╕Зр╕▓р╕Щр╣Ар╕вр╣Зр╕Ъ/р╕Ьр╕ер╕┤р╕Х
- "р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╣Бр╕Ьр╕Щ vs р╕Ир╕гр╕┤р╕Зр╕Ир╕▓р╕Бр╕Хр╕▓р╕гр╕▓р╕З sewing_man_plan р╣Бр╕ер╕░ sewing_man_act"
- "р╕кр╕гр╕╕р╕Ы productivity target р╕Ир╕▓р╕Бр╕Хр╕▓р╕гр╕▓р╕З sewing_productivity_plan"
- "р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕вр╕Бр╕▓р╕гр╕Ьр╕ер╕┤р╕Хр╕Ир╕▓р╕Б sewing_target р╣Бр╕вр╕Бр╕Хр╕▓р╕б item"

### р╕Др╕зр╕Ър╕Др╕╕р╕бр╕Др╕╕р╕Ур╕ар╕▓р╕Ю
- "р╕лр╕▓р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Ыр╕▒р╕Нр╕лр╕▓р╕Ир╕▓р╕Б qc_issue р╕Чр╕╡р╣Ир╣Ар╕Бр╕┤р╕Фр╕Ър╣Ир╕нр╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф"
- "р╕кр╕гр╕╕р╕Ыр╕Ир╕│р╕Щр╕зр╕Щр╕Зр╕▓р╕Щ NG р╕Ир╕▓р╕Б qc_ng р╣Гр╕Щр╣Ар╕Фр╕╖р╕нр╕Щр╕Щр╕╡р╣Й"
- "р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Юр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╣Бр╕Ьр╕Щр╕Б FB, FC, RB, RC"

## ЁЯФН р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕вр╕Вр╕нр╕Зр╕Яр╕┤р╕ер╕Фр╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕е

### р╕Яр╕┤р╕ер╕Фр╣Мр╕кр╕│р╕Др╕▒р╕Н
- **item:** р╕гр╕╕р╣Ир╕Щр╕лр╕гр╕╖р╕нр╣Вр╕бр╣Ар╕Фр╕ер╕Вр╕нр╕Зр╕Ьр╕ер╕┤р╕Хр╕ар╕▒р╕Ур╕Ср╣М
- **qty:** р╕Ир╕│р╕Щр╕зр╕Щ (р╕Кр╕┤р╣Йр╕Щ/р╕лр╕Щр╣Ир╕зр╕в)
- **created_at:** р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е

### ЁЯз╡ р╕Хр╕▓р╕гр╕▓р╕Зр╕Зр╕▓р╕Щр╣Ар╕вр╣Зр╕Ъ/р╕Ьр╕ер╕┤р╕Х (sewing_*)
- **sewing_man_act:** р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З (actual manpower)
- **sewing_man_plan:** р╕зр╕▓р╕Зр╣Бр╕Ьр╕Щр╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ (planned manpower)  
- **sewing_productivity_plan:** р╕Бр╕│р╕лр╕Щр╕Ф productivity target
- **sewing_target:** р╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕вр╕Бр╕▓р╕гр╕Ьр╕ер╕┤р╕Х
- **sewing_lot:** р╕Вр╣Йр╕нр╕бр╕╣р╕е lot р╕Бр╕▓р╕гр╕Ьр╕ер╕┤р╕Х
- **sewing_fb/fc/rb/rc:** р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Зр╕▓р╕Щр╣Ар╕вр╣Зр╕Ър╣Бр╕Хр╣Ир╕ер╕░р╣Бр╕Ьр╕Щр╕Б
- **sewing_3rd/sub:** р╕Зр╕▓р╕Щр╕Ир╣Йр╕▓р╕Зр╣Ар╕лр╕бр╕▓р╕ар╕▓р╕вр╕Щр╕нр╕Бр╣Бр╕ер╕░р╕Ир╣Йр╕▓р╕Зр╣Ар╕лр╕бр╕▓р╕Кр╣Ир╕зр╕З

### ЁЯФН р╕Хр╕▓р╕гр╕▓р╕Зр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Др╕╕р╕Ур╕ар╕▓р╕Ю (qc_*)
- **qc_ng:** р╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Зр╕▓р╕Щ NG (р╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Др╕бр╣Ир╕Ьр╣Ир╕▓р╕Щр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ)
- **qc_issue:** р╣Ар╕Бр╣Зр╕Ър╕Кр╕╖р╣Ир╕нр╕ер╕▒р╕Бр╕йр╕Ур╕░р╕Зр╕▓р╕Щ NG (р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Ыр╕▒р╕Нр╕лр╕▓)
- **qc_fb/fc/rb/rc:** р╕Вр╣Йр╕нр╕бр╕╣р╕е QC р╣Бр╕Хр╣Ир╕ер╕░р╣Бр╕Ьр╕Щр╕Б
- **qc_3rd/sub:** QC р╕Зр╕▓р╕Щр╕Ир╣Йр╕▓р╕Зр╣Ар╕лр╕бр╕▓р╕ар╕▓р╕вр╕Щр╕нр╕Бр╣Бр╕ер╕░р╕Ир╣Йр╕▓р╕Зр╣Ар╕лр╕бр╕▓р╕Кр╣Ир╕зр╕З

## ЁЯЫая╕П р╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓р╕Хр╣Ир╕н

### р╣Ар╕Юр╕┤р╣Ир╕бр╕Хр╕▓р╕гр╕▓р╕Зр╣Гр╕лр╕бр╣И
р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕Щ `database.py`:

```python
def get_default_allowed_tables() -> List[str]:
    return [
        # р╣Ар╕Юр╕┤р╣Ир╕бр╕Хр╕▓р╕гр╕▓р╕Зр╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣Ир╕Щр╕╡р╣И
        'new_table_name',
        # ...
    ]
```

### р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З LLM Prompt
р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕Щ `config.py`:

```python
SYSTEM_HINT = """
р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╕бр╣И...
"""
```

## ЁЯРЫ р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓

### р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
```bash
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н
curl http://localhost:8000/health
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ Ollama
```bash
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Ollama
ollama list
ollama run llama3.1 "р╕кр╕зр╕▒р╕кр╕Фр╕╡"
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ Import Module
```bash
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Python path
python -c "import sys; print(sys.path)"

# р╕Цр╣Йр╕▓р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ р╣Гр╕лр╣Йр╣Ар╕Юр╕┤р╣Ир╕б PYTHONPATH
export PYTHONPATH=/path/to/parent/directory:$PYTHONPATH
```

## ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

- р╣Вр╕Ыр╕гр╣Ар╕Ир╕Др╕Щр╕╡р╣Йр╣Гр╕Кр╣Й Langchain 0.3.27 р╕Лр╕╢р╣Ир╕Зр╕бр╕╡ deprecation warnings р╕кр╕│р╕лр╕гр╕▒р╕Ъ Ollama class
- р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕Ыр╕гр╣Ар╕Ир╕Др╣Гр╕лр╕бр╣И р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╣Йр╣Гр╕Кр╣Й `langchain-ollama` package
- р╕Хр╕▒р╕з Agent р╣Гр╕Кр╣Й ZERO_SHOT_REACT_DESCRIPTION р╕Лр╕╢р╣Ир╕Зр╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ъ SQL queries
- Temperature р╕Хр╕▒р╣Йр╕Зр╣Др╕зр╣Йр╕Чр╕╡р╣И 0.1 р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Фр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕бр╣Гр╕Щ SQL generation

## ЁЯСе р╕Ьр╕╣р╣Йр╕Юр╕▒р╕Тр╕Щр╕▓

- Automotive Team
- Version: 1.0.0